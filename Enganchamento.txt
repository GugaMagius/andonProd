select 
ctbl.IDWOGRP,
item.Code,
ctbl.IDBastidor,
ctbl.Quantidade,
ctbl.DTTIMESTAMP,
convert(time, ctbl.DTTIMESTAMP) Hora,
CASE
	WHEN DATEPART(hh,ctbl.DTTIMESTAMP)<8 then ctbl.DTTIMESTAMP-1
	ELSE ctbl.DTTIMESTAMP
END as DataProd
from CTBLWOGRP ctbl
inner join TBLWOHD op on (op.Code = ctbl.WOCODE)
inner join TBLProduct item on (item.IDProduct = op.IDProduct)
where ctbl.IDBastidor is not null 
and 
CASE
	WHEN DATEPART(hh,ctbl.DTTIMESTAMP)<8 then ctbl.DTTIMESTAMP-1
	ELSE ctbl.DTTIMESTAMP
END  >= convert(datetime2, DATEADD(dd, 0, DATEDIFF(dd, 0, GETDATE()-10))) 